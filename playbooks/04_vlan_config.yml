---
- name: VLAN Configuration
  hosts: switches
  gather_facts: false

  tasks:
    - name: Create VLANs
      cisco.ios.ios_config:
        lines:
          - vlan 10
          - name Data
          - vlan 20
          - name Server
          - vlan 30
          - name Voice

    - name: Configure SVI for VLAN 10 (Data)
      cisco.ios.ios_config:
        parents: interface Vlan10
        lines:
          - ip address 192.168.1.1 255.255.255.0
          - no shutdown

    - name: Configure SVI for VLAN 20 (Server)
      cisco.ios.ios_config:
        parents: interface Vlan20
        lines:
          - ip address 192.168.2.1 255.255.255.0
          - no shutdown

    - name: Configure SVI for VLAN 30 (Voice)
      cisco.ios.ios_config:
        parents: interface Vlan30
        lines:
          - ip address 192.168.3.1 255.255.255.0
          - no shutdown

    - name: Apply data and voice VLANs to G0/3
      cisco.ios.ios_config:
        parents: interface GigabitEthernet0/3
        lines:
          - switchport mode access
          - switchport access vlan 10
          - switchport voice vlan 30
          - no shutdown

    - name: Apply data and voice VLANs to G0/4
      cisco.ios.ios_config:
        parents: interface GigabitEthernet0/4
        lines:
          - switchport mode access
          - switchport access vlan 10
          - switchport voice vlan 30
          - no shutdown

    - name: Apply server VLAN to G0/5
      cisco.ios.ios_config:
        parents: interface GigabitEthernet0/5
        lines:
          - switchport mode access
          - switchport access vlan 20
          - no shutdown

    - name: Configure trunk interface G0/1
      cisco.ios.ios_config:
        parents: interface GigabitEthernet0/1
        lines:
          - switchport mode trunk
          - switchport trunk allowed vlan 10,20,30,100
          - no shutdown

    - name: Configure trunk interface G0/2
      cisco.ios.ios_config:
        parents: interface GigabitEthernet0/2
        lines:
          - switchport mode trunk
          - switchport trunk allowed vlan 10,20,30,100
          - no shutdown

    - name: VLAN verification
      cisco.ios.ios_command:
        commands:
          - show vlan brief
          - show ip interface brief
      register: verification_output

    - name: Display verification output
      debug:
        var: verification_output.stdout_lines
